document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        googleCalendarApiKey: 'YOUR_API_KEY',
        events: {
            googleCalendarId: 'YOUR_CALENDAR_ID'
        },
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'timeGridWeek,dayGridMonth'
        },
        slotMinTime: '06:00:00',
        slotMaxTime: '22:00:00',
        allDaySlot: false,

        // FIX 1: Ensures the title and description appear inside the box
        eventContent: function(arg) {
            let title = arg.event.title || 'Available Session';
            let arrayOfDomNodes = [
                Object.assign(document.createElement('div'), {
                    innerHTML: `<div class="font-black uppercase text-[10px] leading-tight">${title}</div>`,
                    className: 'fc-event-title-container'
                })
            ];
            return { domNodes: arrayOfDomNodes };
        },

        // FIX 2: Makes the slot clickable to "Claim" via email
        eventClick: function(info) {
            info.jsEvent.preventDefault(); // Prevents going to Google Calendar site
            
            const sessionTitle = info.event.title || "Available Session";
            const sessionTime = info.event.start.toLocaleString([], { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            // Pre-fills the email for the user
            const email = "mattdoylebball@gmail.com";
            const subject = encodeURIComponent(`Claiming Session: ${sessionTitle}`);
            const body = encodeURIComponent(
                `Hi Matt,\n\nI would like to claim the training slot for:\n${sessionTime}\n\nMy Details:\nName: [Enter Name]\nPhone: [Enter Phone]\n\nPlease let me know if this works!`
            );

            window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
        }
    });

    calendar.render();
});